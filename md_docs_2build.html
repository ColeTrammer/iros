<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.10.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iros: Build Instructions</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <!-- ... other metadata & script includes ... -->
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeParagraphLink.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init();
    </script>
  </head>
  <body>
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">
                    Iros
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2build.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build Instructions</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Using provided dev container</h1>
<p>The easiest way to build and run Iros is to use the provided dev container. The CI pipeline for the repository builds and tests the toolchain image, which ensures everything will work inside the dev container.</p>
<p>To use the dev container, use Visual Studio Code and install the remote contains extension. VS Code will then prompt you to open the repository inside the dev container. This will also automatically install relevant VS Code extensions, which enables building and running tests through the VS Code CMake extension.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Build the toolchain locally</h1>
<p>In order to use something other than VS Code, it is probably easiest to just build the toolchain locally. Once finished, the project can be built like a normal CMake project, and intellisense can be provided using <code>compile_commands.json</code> and any c++ language server. Currently, your best bet is to use <code>clangd</code>, as the project uses bleeding-edge c++ features which only <code>clang</code> and <code>gcc</code> support. The Microsoft C++ engine is not recommended, as it cannot compile the project's source code.</p>
<p>In addition, the project requires at least GCC 12.1.0 or clang 16 and CMake 3.25.2 to compile. The CMake version can probably be relaxed, but GCC 11 will fail to compile the system. Likewise, clang-15 will not compile the system. Currently, the clang support is experimental, since there is not a custom toolchain target for llvm. Testing the kernel additionally requires various system commands, including <code>parted</code>, <code>mkfs.fat</code>, and <code>qemu</code>. A full list of packages needed under Ubuntu can be found in the <a href="https://github.com/ColeTrammer/iros/tree/iris/meta/docker/Dockerfile">dockerfile</a>. This dockerfile also provides steps which install the latest version of CMake and clang on Ubuntu. For other Linux distros, you will have to look up the corresponding package names for your distro. At the very least, this list of dependencies is actively tested in CI, and so will always be up to date.</p>
<p>To build the project documentation, you must have the latest version of Doxygen installed, and Graphviz is needed to generate the various diagrams. If Doxygen is not installed, the <code>docs</code> target will not exist in the generated build system.</p>
<p>Build the toolchain.</p>
<div class="fragment"><div class="line">./meta/toolchain/build.sh</div>
</div><!-- fragment --><p>Add <code>cross/bin</code> to your path. This is only needed when configuring the build for the first time.</p>
<div class="fragment"><div class="line">export PATH=&quot;$(realpath .)/cross/bin:$PATH&quot;</div>
</div><!-- fragment --><p>At this point, the entire system should be buildable with cmake.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Build Commands</h2>
<p>Note that these commands apply using a dev container or locally, once things are setup. To use clang instead, use the <code>clang_iros_x86_64_release_default</code> preset instead.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Configure</h3>
<div class="fragment"><div class="line">cmake --preset gcc_iros_x86_64_release_default</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
Build</h3>
<div class="fragment"><div class="line">cmake --build --preset gcc_iros_x86_64_release_default</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md6"></a>
Run Tests</h3>
<div class="fragment"><div class="line">ctest --preset gcc_iros_x86_64_release_default</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Run the kernel directly</h3>
<div class="fragment"><div class="line">cmake --build --preset gcc_iros_x86_64_release_default --target ibr</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Build Documentation</h3>
<p>This outputs the viewable documentation to <code>build/x86_64/gcc/release/default/html</code>. This can be viewed using the VS Code Live Preview or by pointing a web browser at this directory.</p>
<div class="fragment"><div class="line">cmake --build --preset gcc_iros_x86_64_release_default --target docs</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Building For Linux</h2>
<p>To get the required Linux dependencies, it is recommended to use the <code>nix</code> flake provided in the repository root. Once the <code>nix</code> package manager is installed, you can simply run <code>nix develop</code> to be placed into a shell which includes all packages need to build and run the userspace programs on Linux.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Linux Presets</h2>
<p>Additionally, presets are defined for compiling the userland libraries and their unit tests on a Linux system. A list of presets should be displayed by the IDE, or can discovered in the <code>CMakePresets.json</code> file. These can be useful for debugging purposes, especially because we can use sanitizers directly. For instance, the <code>gcc_debug_ubasan</code> preset compiles the userspace code with both <code>ubsan</code> and <code>asan</code> enabled. This configuration is actively tested in CI.</p>
<p>These can be built and used without any special setup, using normal CMake commands, although recent versions of GCC or clang and CMake are needed.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Build Directories</h1>
<p>The CMake presets assign separate build directories for each target. Each is located in a subdirectory of <code>build</code>. The build directories are named after the target and the preset used to build it. For instance, the <code>gcc_iros_x86_64_release_default</code> preset corresponds to a build directory of <code>build/x86_64/gcc/release/default</code>. The host tools required to build the kernel are located in <code>build/host/gcc/release/tools</code>. All x86_64 builds share the same install directory, which is used as the system root for the disk image. This is located in <code>build/x86_64/sysroot</code>.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Running the Kernel</h1>
<p>The kernel can be run using QEMU. Currently, the kernel does not support graphical output, and so it must be run in a terminal. The kernel uses the serial console to do input and output. Since there is also need for the QEMU debug console, this mode uses QEMU's chardev multiplexer. This means that exiting the kernel must be done using the special QEMU command: <code>Ctrl-A X</code>. This will exit the QEMU debug console, and then the kernel will exit. To get to the QEMU debug console, use <code>Ctrl-A C</code>. Then the kernel can be inspected using normal QEMU commands.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Debugging the Kernel</h2>
<p>The kernel can be debugged using GDB or LLDB. This requires passing <code>IROS_DEBUG=1</code> to the run script, which is done automatically when using the VSCode launch configurations. These start QEMU in debug mode and then attach to the QEMU socket. This requires using the <code>debug_iros_x86_64</code> preset, or else symbols and breakpoint information will not be available. Additionally, debugging is mostly useful for boot issues, as there is no way to debug userspace programs and once the kernel scheduler is running, the debugger interferes with the timer interrupts. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Iros Project Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>

<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.10.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iros: Development Plan</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <!-- ... other metadata & script includes ... -->
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeParagraphLink.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init();
    </script>
  </head>
  <body>
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">
                    Iros
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2iris_2design_2development__plan.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Development Plan</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md111"></a> Constructing an functioning kernel requires a large amount of code and development effort. Furthermore, the point at which development feels rewarding is when the kernel is capable of running userspace applications. This makes progressing development challenging, as it takes a long time before the system performs a meaningful task.</p>
<h1><a class="anchor" id="autotoc_md112"></a>
Phase 1: Minimal Kernel</h1>
<p>The initial development effort is to create a minimal kernel which can run a userspace program. Additionally, core kernel functionality which is hard to retroactively must be put into place. This includes security measures and multi processing support (SMP).</p>
<h2><a class="anchor" id="autotoc_md113"></a>
Minimal Steps Needed to Run a Program (x86_64)</h2>
<p>For the minimal case, we can skip pre-emptive scheduling, file system IO, and executable loading by using co-operative scheduling and executing a kernel function directly in ring 3.</p>
<ol type="1">
<li>Get control of the CPU</li>
<li>Setup the GDT and TSS</li>
<li>Create a list of task objects in the kernel</li>
<li>Context switch to a newly created task</li>
</ol>
<h2><a class="anchor" id="autotoc_md114"></a>
Next Steps for Running a Simple Program</h2>
<p>The above steps allow ring 3 code to execute, but the code cannot really be useful. However, the program should be able to print to the serial port if the kernel relaxes the restrictions on IO port usage. However, a system call interface needs to be added so support subsequent development, to perform things like memory allocation and yeilding execution.</p>
<ol type="1">
<li>Basic system calls (syscall instruction) for printing</li>
</ol>
<h2><a class="anchor" id="autotoc_md115"></a>
Steps Completeable in Isolation</h2>
<p>There are several more components which are needed to have a properly functioning kernel, but these can be carried out independently.</p>
<ol type="1">
<li>Setup the IDT to enable coding device drivers</li>
<li>Setup HW timer to keep track of time</li>
<li>Preemptive scheduling [requires IDT and HW timer driver]</li>
<li>Virtual memory management (mmap() system call)</li>
<li>Block device driver (floppy, PATA, AHCI, or, nvme)</li>
<li>File system driver (ext2, FAT, initrd) [requires block driver]</li>
<li>Executable loading (ELF) [requires file system or boot loader module]</li>
<li>Userspace runtime library (to make system calls)</li>
</ol>
<p>The end result of completing these items would be a kernel capable of running basic programs. Note that some steps can be completed in isolation but will likely need refactoring if done in the incorrect order. For instance, the file system driver can be developed before deciding on a proper VFS API, but it would then need to be changed later. Likewise, an executable loader which accesses the file system driver would need to change as well.</p>
<p>However, this is acceptable because the VFS API is extremely important, and will likely be influcenced by kernel architecture decisions (separate processes per fs as well as asnchronous first API).</p>
<p>This means that individual components created during this time period should be as minimal as possible.</p>
<h2><a class="anchor" id="autotoc_md116"></a>
Note on Microkernel Architecture</h2>
<p>For the initial period of development, the intention to create a microkernel should be ignored. This is simply because separate processes are impossible when the kernel itself does not support processes. Ideally, the kernel will have a sensible user-facing API, which would allow the internal implementation of kernel components to slowly be moved into separate processes.</p>
<h2><a class="anchor" id="autotoc_md117"></a>
Overall Development Intent</h2>
<p>The number one goal should be to run a userspace program properly. Until acheiving this goal, the kernel code is allowed to be poorly architected and thought-out. All that matter is getting to a point where the code actually does something. At this point, the code should be refactored, which making sure it is still functioning.</p>
<h1><a class="anchor" id="autotoc_md118"></a>
Phase 2: Full Vertical Slices</h1>
<p>Once the kernel is capable of running a userspace program, and has some core solid-ish foundations, the next step is to add the remaining components. This will require refactoring and a lot of combined work between kernel and userspace. For example, the kernel will need to implement filesystem support via a VFS. Userspace will need to support consuming abstractions, the libc must provide POSIX compatibility, and userspace must also implement concrete filesystem drivers. Ideally, userspace programs for creating and inspecting disk images should be added as well. This is just one example, and there are many other components which will need to be implemented.</p>
<h2><a class="anchor" id="autotoc_md119"></a>
Vertical Slices</h2>
<ul>
<li>File system</li>
<li>Memory management</li>
<li>Process management</li>
<li>Time keeping</li>
<li>Dynamic linking</li>
<li>Networking</li>
<li>Graphics</li>
<li>Audio</li>
<li>Syncronization</li>
<li>Containerization</li>
</ul>
<h2><a class="anchor" id="autotoc_md120"></a>
Horizontal Slices</h2>
<p>For constrast, horizontal slices refer the individual components themselves. The idea is that each vertical slice is part of expanding multiple horizontal slices, which effectively means that the whole system becomes more usable. For instance, POSIX compatibility is a horizontal slice, and different system calls fall into different vertical slices.</p>
<ul>
<li>POSIX compatibility</li>
<li>Dius userspace library</li>
<li>Iris kernel</li>
<li>Userspace applications</li>
</ul>
<h2><a class="anchor" id="autotoc_md121"></a>
File System</h2>
<p>The file system is the heart of modern operating systems. In many systems, every other API is effectively built on top of the file system. At the same time, the file system API determines the performance and usability of the system. Without a good page caching mechanism, the OS will be painfully slow in comparison to other systems. Unfortunately, there is a lot that needs to be done to create a good VFS API, and exposing this to userspace will require a lot of thinking.</p>
<h2><a class="anchor" id="autotoc_md122"></a>
Memory Management</h2>
<p>Memory management and the file system are somewhat intertwined, especially considering concepts such as POSIX mmap() and the potential need to swap out memory. Although memory management is a bit less complicated, as it will probably not be mostly done in userspace, it still requires a lot of refactoring. Currently, the kernel can really only immediately map pages, and doesn't support lazy allocation, copy-on-write, or swapping. And privledged kernel-space APIs will need to be added to implement certain drivers in userspace.</p>
<h2><a class="anchor" id="autotoc_md123"></a>
Process Management</h2>
<p>Process management is important for POSIX compatibility and the shell. It is especially unclear what abstractions the kernel should expose, because the goal is not implement POSIX directly, but to have userspace be able to effectively emulate it. Of particular note is the need to implement fork() and POSIX signals.</p>
<h2><a class="anchor" id="autotoc_md124"></a>
Time Keeping</h2>
<p>Time keeping is comparatively simple, but there are additional drivers the kernel needs to implement (RTC, HPET, etc). Userspace must expose this API, which involves working on the chrono library component, and POSIX compatibility. And some timer mechanism needs to be implemented.</p>
<h2><a class="anchor" id="autotoc_md125"></a>
Dynamic Linking</h2>
<p>Dynamic linking requires some work in the kernel, to support ELF interpreters. However, the bulk of the work is in the dynamic linker, but libc also needs to be updated to support it.</p>
<h2><a class="anchor" id="autotoc_md126"></a>
Networking</h2>
<p>Networking is actually one of most execiting components to implement. The kernel will need to implement a network stack, and userspace needs to be able to consume it. With the focus asynchronous IO, the hope is to be able to implement a performant system. It would be exciting to compare this implementation on between Linux and Iros.</p>
<h2><a class="anchor" id="autotoc_md127"></a>
Graphics</h2>
<p>Graphics is likely to be very difficult. Most likely, the goal should be to port X11 or Wayland to the system. This will involves lot of POSIX compatibility work, and a choice must be made as to whether to support the Linux DRM API or to port these programs to some other custom API.</p>
<h2><a class="anchor" id="autotoc_md128"></a>
Audio</h2>
<p>Audio is a lot approachable than graphics, but I don't know much about it. The kernel will need to have some sort of API and support audio drivers, and userspace will need to implement a audio server. Hypothetically, porting some Linux solution could also be done.</p>
<h2><a class="anchor" id="autotoc_md129"></a>
Syncronization Primitives</h2>
<p>Synchonization primitives are important for applications and the pthreads library. The kernel will need to implement either <code>futex</code> or some other mechanism for implementing these sorts of things.</p>
<h2><a class="anchor" id="autotoc_md130"></a>
Containerization</h2>
<p>Containerization is a bit of a stretch goal, but it would be nice to have. The kernel will need to implement some sort of virtualization mechanism, and userspace will need to implement a container runtime. Look at Linux KVM for inspiration. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Iros Project Documentation</a></li><li class="navelem"><a class="el" href="md_docs_2iris_2table__of__contents.html">Iris Kernel Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>

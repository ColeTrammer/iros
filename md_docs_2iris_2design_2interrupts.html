<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.10.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iros: Interrupts</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <!-- ... other metadata & script includes ... -->
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeParagraphLink.init();
    </script>
    <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init();
    </script>
  </head>
  <body>
      <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr id="projectrow">
                <td id="projectalign">
                  <div id="projectname">
                    Iros
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2iris_2design_2interrupts.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Interrupts</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md136"></a> </p>
<h1><a class="anchor" id="autotoc_md137"></a>
Explanation</h1>
<p>An interrupt refers to the currently executing processor stopping its current execution in response to some event. This usually acts as a mini context switch, where the processor effectively loads new values for the stack, and saves the old processor state to be resumed later.</p>
<h1><a class="anchor" id="autotoc_md138"></a>
Interrupt Sources</h1>
<p>In practice, there are 3 types of interrupt sources.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Source   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU   </td><td class="markdownTableBodyNone">Exception, occurs on page fault or dividing by zero    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Programmed   </td><td class="markdownTableBodyNone">Caused directly by userspace, on x86 using the <code>int</code> instruction    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">External   </td><td class="markdownTableBodyNone">Caused by hardware, needs to be responded to by specific device drivers   </td></tr>
</table>
<p>Each kind of source requires slightly different handling. In particular, CPU exceptions do not require interaction with any external components, but may effect the currently running task. For instance, a page fault would require the kernel to load memory from disk, potentially blocking the task for a long time.</p>
<p>On the other hand, external interrupts usually require interacting directly with the hardware that caused the interrupt. Additionally, an interrupt controller device has to be informed the interrupt was handled successfully. These contexts also have no associated task, and so cannot block. HW interrupt handlers <em>should</em> perform as little work as possible.</p>
<p>Lastly, user specified interrupts are used to invoke system calls. These are performance sensitive, and so can be dealt with in a special fast path.</p>
<h1><a class="anchor" id="autotoc_md139"></a>
Hardware Interrupts</h1>
<p>One difficult aspect of hardware interrupts is that devices can share the same interrupt line. This is especially common in old PCI devices, since there are only 4 interrupt lines available to all PCI devices (on x86 before MSI). As such, interrupt handlers must be prepared to encounter spurious interrupts, which do not correspond to an event for the specific device they are interested in. Even without shared interrupts, spurious interrupts can occur due to hardware interference/noise.</p>
<p>Another confusing aspect is the actual mechanism by which to determine the interrupt line a device is wired too. For x86 legacy devices, this value is effectively hardcoded, but this is likely not the case in more recent devices. Additionally, interrupts have to be routed through an interrupt controller, and there can be multiple such devices (IO APICs) on certain chipsets. And different devices may differentiate between edge-triggered and level-triggered interrupts.</p>
<h2><a class="anchor" id="autotoc_md140"></a>
NMI</h2>
<p>Non-maskable interrupts will always fire, even if the processor has disabled interrupts. The most known cause for this exception is that the computer's RAM failed in some way. This requires special handling in the kernel, because technically NMI's can nest, and can also occur at any point in a program's execution.</p>
<h2><a class="anchor" id="autotoc_md141"></a>
Note for Micro-Kernels</h2>
<p>In general, we want to respond as quickly as possible to HW interrupts. However, when dealing with out-of-kernel device drivers, the kernel would typically have to wait for them to finish handling each IRQ before it can exit IRQ context, and then send the EOI signal to the interrupt controller. As consequence, most micro-kernels allow drivers to load code whose sole purpose is responding to interrupts in the kernel. This language can be simple, but it is required to allow drivers to respond to interrupts and also must be provably safe. In addition, a more complex language can be extended to other tasks, like eBNF is on Linux (note that eBNF is not used for interrupts on Linux, but does have many other applications). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Iros Project Documentation</a></li><li class="navelem"><a class="el" href="md_docs_2iris_2table__of__contents.html">Iris Kernel Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
